# ğŸ“Œ DÃ©finition de la version de l'API Kubernetes pour les objets Deployment (ici apps/v1 pour gÃ©rer les dÃ©ploiements)
apiVersion: apps/v1

# ğŸ“Œ Type de l'objet Kubernetes, ici un DÃ©ploiement (Deployment) qui permet de gÃ©rer les pods
kind: Deployment

# ğŸ“Œ MÃ©tadonnÃ©es liÃ©es au dÃ©ploiement
metadata:
  # ğŸ·ï¸ Nom du dÃ©ploiement. Il est utilisÃ© pour identifier ce Deployment dans Kubernetes
  name: posts-depl

# ğŸ“Œ SpÃ©cifications du dÃ©ploiement
spec:
  # ğŸ”„ Nombre de rÃ©plicas (copies) du pod que Kubernetes doit maintenir en fonctionnement
  replicas: 1  # Ici, un seul pod est instanciÃ©

  # ğŸ¯ SÃ©lecteur qui permet Ã  Kubernetes dâ€™associer ce dÃ©ploiement aux pods correspondants
  selector:
    # ğŸ·ï¸ CritÃ¨re de sÃ©lection basÃ© sur un label spÃ©cifique (app: posts)
    matchLabels:
      app: posts  # Ce label associe les pods au dÃ©ploiement

  # ğŸ“Œ ModÃ¨le de pod utilisÃ© par le dÃ©ploiement pour crÃ©er les instances de pods
  template:
    metadata:
      # ğŸ·ï¸ Labels dÃ©finis pour le pod, qui doivent correspondre au sÃ©lecteur ci-dessus
      labels:
        app: posts  # Label qui lie le pod au Deployment

    spec:
      # ğŸ“Œ DÃ©finition des containers qui seront exÃ©cutÃ©s dans le pod
      containers:
        - name: posts  # Nom du conteneur, utilisÃ© pour l'identification interne
          image: elbraco/posts  # ğŸ³ Image Docker utilisÃ©e pour ce conteneur

---

# ğŸ“Œ DÃ©finition d'un Service Kubernetes pour exposer le pod "posts"
apiVersion: v1
kind: Service
metadata:
  name: posts-clusterip-srv  # ğŸ·ï¸ Nom du service, utilisÃ© pour rÃ©fÃ©rencer ce service dans Kubernetes

spec:
  # ğŸ¯ SÃ©lecteur permettant dâ€™associer ce service aux pods avec le label "app: posts"
  selector:
    app: posts  # Associe ce service aux pods qui portent le label "app: posts"

  # ğŸ“Œ DÃ©finition des ports sur lesquels le service sera accessible
  ports:
    - name: posts  # Nom du port, utile pour l'identification interne
      protocol: TCP  # ğŸ“¡ Protocole utilisÃ© (TCP, standard pour la communication rÃ©seau)
      port: 4000  # ğŸ“Œ Port exposÃ© par le service (accÃ¨s au sein du cluster)
      targetPort: 4000  # ğŸ¯ Port interne du pod cible (doit correspondre au port utilisÃ© par lâ€™application)

# ğŸ“ DÃ©brief gÃ©nÃ©ral :
# - Ce fichier dÃ©finit un **Deployment** et un **Service** pour lâ€™application `posts`.
# - **Deployment** :
#   - Il crÃ©e un seul pod (`replicas: 1`) basÃ© sur lâ€™image `elbraco/posts`.
#   - Il associe ce pod avec le label `app: posts` pour pouvoir le retrouver facilement.
# - **Service** :
#   - Il expose le pod `posts` en interne dans Kubernetes avec le nom `posts-clusterip-srv`.
#   - Il route le trafic vers le port 4000 du pod.
# - Ce **Service** est de type `ClusterIP` (par dÃ©faut), ce qui signifie qu'il est uniquement accessible **depuis l'intÃ©rieur du cluster**.

# ğŸš€ AmÃ©liorations possibles :
# - Augmenter le nombre de `replicas` pour une meilleure disponibilitÃ© et rÃ©silience.
# - Ajouter une `readinessProbe` et `livenessProbe` pour garantir que le pod est sain et prÃªt Ã  recevoir du trafic.
# - Ajouter une gestion des **logs** et de la **surveillance** pour suivre l'Ã©tat du pod.
# - Si l'application doit Ãªtre accessible depuis l'extÃ©rieur du cluster, envisager un **Service de type NodePort ou LoadBalancer**.
